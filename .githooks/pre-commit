#!/usr/bin/env bash
set -euo pipefail

REPO_ROOT="$(git rev-parse --show-toplevel)"
# 兼容路径
if command -v cygpath >/dev/null 2>&1; then ROOT_WIN="$(cygpath -w "$REPO_ROOT")"; else ROOT_WIN="$REPO_ROOT"; fi
# 选择 pwsh 或 powershell.exe
if command -v pwsh >/dev/null 2>&1; then PS_EXE="pwsh"; else PS_EXE="powershell.exe"; fi

"$PS_EXE" -NoLogo -NoProfile -ExecutionPolicy Bypass \
  -File "$ROOT_WIN/Tools/ndjc-selfcheck.ps1" \
  -RepoRoot "$ROOT_WIN" \
  -TemplatesDir "templates/core-template" \
  -ExpectedDir "anchors" \
  -FailOnMissing      # ← 这里只写名字，不要 :$true
